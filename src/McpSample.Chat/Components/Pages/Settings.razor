@page "/configuracoes"
@rendermode InteractiveServer

<PageTitle>Configurações</PageTitle>

<h1>Configurações</h1>

<div>
    <label for="endpoint">Endpoint:</label>
    <input type="url" id="endpoint" @bind="endpoint" class="input-field" />
</div>
<div>
    <label for="deploymentName">Nome do Modelo:</label>
    <input type="text" id="deploymentName" @bind="nomeModelo" class="input-field" />
</div>
<div>
    <label for="apiKey">API Key / GitHub Token:</label>
    <input type="password" id="apiKey" @bind="chaveApi" class="input-field" />
</div>

<button class="btn btn-primary" @onclick="SaveSettings">Salvar</button>
<button class="btn btn-secondary" @onclick="SetOllamaDefaults">Setar configuração padrão Ollama</button>
<button class="btn btn-secondary" @onclick="SetGitHubModelsDefaults">Setar configuração padrão GitHub Models</button>

<p>
    Para criar um token do GitHub para ser usado no campo <strong>API Key / GitHub Token</strong>, siga as instruções
    <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens" target="_blank">aqui</a>.
</p>

@if (!string.IsNullOrEmpty(mensagemSalvar))
{
    <div class="save-message">@mensagemSalvar</div>
}

@code {
    private string endpoint = string.Empty;
    private string chaveApi = string.Empty;
    private string nomeModelo = string.Empty;
    private string mensagemSalvar = string.Empty;

    [Inject]
    private IConfiguration Configuration { get; set; } = default!;

    protected override void OnInitialized()
    {
        endpoint = Configuration["endpoint"] ?? string.Empty;
        chaveApi = Configuration["apikey"] ?? string.Empty;
        nomeModelo = Configuration["deploymentname"] ?? string.Empty;
    }

    private void SaveSettings()
    {
        // Save the settings to the configuration
        Configuration["endpoint"] = endpoint;
        Configuration["apikey"] = chaveApi;
        Configuration["deploymentname"] = nomeModelo;

        // Display a message to inform the user that the changes were saved
        mensagemSalvar = "As configurações foram salvas com sucesso.";
    }

    private void SetGitHubModelsDefaults()
    {
        endpoint = "https://models.inference.ai.azure.com";
        chaveApi = "<informe seu GitHub Personal Access Token>";
        nomeModelo = "<nome do modelo>";

    }

    private void SetOllamaDefaults()
    {
        endpoint = "http://localhost:11434/";
        chaveApi = string.Empty;
        nomeModelo = "llama3.2";
    }
}

<style>
    h1 {
        color: #4a148c;
    }

    .input-field {
        display: block;
        margin-bottom: 10px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
        max-width: 400px;
    }

    .btn-primary {
        background-color: #6a1b9a;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
    }

        .btn-primary:hover {
            background-color: #4a148c;
        }

    .btn-secondary {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 10px;
    }

        .btn-secondary:hover {
            background-color: #0056b3;
        }

    .save-message {
        margin-top: 20px;
        color: #4a148c;
        font-weight: bold;
    }
</style>
